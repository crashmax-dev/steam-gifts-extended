(function(){"use strict";function o(t,e,...n){const a=document.createElement(t);return e instanceof Node?a.append(e):typeof e=="string"?a.append(c(e)):Array.isArray(e)?a.append(...e):(Object.assign(a,e),Object.assign(a.style,e?.style)),a.append(...n),a}function c(t){return document.createTextNode(t)}function w(){return typeof window<"u"}const h={info:"#2ecc71",debug:"#7f8c8d",warn:"#f39c12",error:"#c0392b"};function b(t,e){return[`%c${t}`,`background:${h[e]};border-radius:0.5em;color:white;font-weightbold;padding:2px 0.5em;font-family:cursive`]}const _={info:"\x1B[32m",debug:"\x1B[90m",warn:"\x1B[33m",error:"\x1B[31m"};function v(t,e){return`${_[e]}${t}\x1B[0m`}class k{#e;info;debug;warn;error;constructor(e){this.#e=e;for(const n of["info","debug","warn","error"])this[n]=(...a)=>this.print(n,...a)}print(e,...n){const a=console[e];w()?a(...b(this.#e,e),...n):a(v(this.#e,e),...n)}}const i=new k("[SteamGiftsExtended]"),l=document.querySelector(".js__logout")?.getAttribute("data-form")?.match(/xsrf_token=(.+)/)?.at(1);l||i.error("xsrf_token not found");async function x(t){return await(await fetch("/ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`xsrf_token=${l}&do=${t.do}&code=${t.code}`})).json()}function S(){const t=q();for(const e of t){const n=L(e);e.links.append(n)}}function q(){const t=document.querySelectorAll("div.giveaway__row-inner-wrap"),e=[];for(let n of t){const a=n.querySelector("span[data-timestamp]");if(!a){i.warn("Giveaway timestamp not found",n);continue}const r=a.getAttribute("data-timestamp");if(r&&Date.now()>Number(r)*1e3)continue;const s=n.querySelector("a.giveaway__heading__name");if(!s){i.warn("Giveaway link not found",n);continue}const m=s.href.split("/").at(-2);if(!m){i.warn("Giveaway ID not found",n);continue}let u=null;const y=n.querySelectorAll("span.giveaway__heading__thin");for(const g of y)if(/\(([0-9]+)([P)])\)/i.test(g.textContent)){u=Number(g.textContent.replace(/\D+/g,""));break}if(u===null){i.warn("Giveaway points not found",y);continue}e.push({links:n.querySelector("div.giveaway__links"),target:n,id:m,points:u})}return e}function f(t){return t.classList.contains("is-faded")?"entry_delete":"entry_insert"}function d(t){return f(t)==="entry_delete"?[o("i",{className:"fa fa-plus-circle"}),c(" "),o("span","Remove giveaway")]:[o("i",{className:"fa fa-minus-circle"}),c(" "),o("span","Entry giveaway")]}function p(t){return f(t)+"-giveaway"}function L(t){const e=o("a",{id:p(t.target),href:"#",onclick:async n=>{n.preventDefault(),e.replaceChildren(o("i",{className:"fa fa-refresh fa-spin"}),c(" "),o("span","Please wait..."));const a=f(t.target),r=await x({do:a,code:t.id});if(r.type==="error")e.replaceChildren(o("i",{className:"error-color error-text fa fa-exclamation-circle"}),c(" "),o("span",{className:"error-color"},r.msg??"Unknown error"));else if(r.type==="success"){const s=document.querySelector("span.nav__points");if(!s){i.error("User points not found");return}s.textContent=r.points,e.replaceChildren(...d(t.target)),t.target.classList.toggle("is-faded"),e.id=p(t.target)}}},...d(t.target));return e}function A(){if(location.pathname!=="/")return;const t=document.querySelector(".page__heading__breadcrumbs");if(!t){i.warn("Breadcrumbs header not found");return}const e=o("a",{href:"#",onclick:async n=>{n.preventDefault();const a=document.querySelectorAll("#entry_insert-giveaway");for(const r of a)r.click(),await new Promise(s=>setTimeout(s,1e3))}},o("i",{className:"fa fa-gift"}));e.setAttribute("data-ui-tooltip",JSON.stringify({rows:[{columns:[{name:"Entry in all giveaways"}]}]})),t.after(e)}function B(){const t=document.querySelectorAll('a[href^="https://store.steampowered.com/app/"][data-ui-tooltip]');for(const n of t){const a=n.href.split("/").at(-2),r=N(a);n.classList.contains("giveaway__icon")&&r.classList.add("giveaway__icon"),n.before(r)}const e=document.querySelectorAll('a[href^="https://steamcommunity.com/profiles/"][data-tooltip]');for(const n of e){const a=n.href.split("/").at(-1),r=D(a);n.after(r)}}function N(t){const e=o("a",{href:`https://steamdb.info/app/${t}/`,target:"_blank"},o("i",{className:"fa fa-fw fa-database"}));return e.setAttribute("data-ui-tooltip",JSON.stringify({rows:[{icon:[{class:"fa-database",color:"#000"}],columns:[{name:"Steam DB"}]}]})),e}function D(t){const e=o("a",{href:`https://steamdb.info/calculator/${t}/`,target:"_blank"},o("i",{className:"fa fa-fw fa-database"}));return e.setAttribute("data-tooltip","Visit SteamDB Profile"),e}function P(){const t=document.querySelector("header");if(!t){i.warn("Header not found");return}Object.assign(t.style,{height:"auto",position:"sticky",zIndex:1,top:0})}GM_addStyle(`.giveaway__links .error-color {
  color: #a95570;
}

.giveaway__links .error-text {
  text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.3);
}
`),P(),B(),S(),A()})();
